<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTERSTELLAR CLUB - Cr√©ation de compte</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        /* Hide scrollbar */
        body::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle at 20% 20%, rgba(56,189,248,.12), transparent 30%),
                        radial-gradient(circle at 80% 0%, rgba(129,140,248,.14), transparent 28%),
                        #0a1122;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #e2e8f0;
        }
        .card {
            width: 500px;
            max-width: 100%;
            background: rgba(17,24,39,0.88);
            border: 1px solid rgba(255,255,255,0.09);
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
        }
        h1 { text-align: center; color: #fff; font-size: 22px; margin-bottom: 6px; }
        .subtitle { text-align: center; color: #e5e7eb; margin-bottom: 16px; }
        .error {
            background: rgba(248,113,113,0.16);
            color: #ffe4e6;
            border: 1px solid rgba(248,113,113,0.45);
            border-radius: 12px;
            padding: 10px 12px;
            margin-bottom: 12px;
            text-align: center;
            font-weight: 600;
        }
        .group { margin-bottom: 14px; }
        label { display: block; color: #e5e7eb; margin-bottom: 6px; font-weight: 600; }
        input, select {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(148,163,184,0.5);
            background: #ffffff;
            color: #0f172a;
            transition: border-color .2s, box-shadow .2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #22d3ee;
            box-shadow: 0 0 0 3px rgba(34,211,238,0.22);
        }
        select option { color: #0f172a; background: #ffffff; }
        button {
            width: 100%;
            padding: 13px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #06b6d4, #4f46e5);
            color: #0f172a;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 12px 28px rgba(79,70,229,0.35);
            transition: transform .15s;
            margin-top: 6px;
        }
        button:hover { transform: translateY(-2px); }
        .switch {
            text-align: center;
            margin-top: 12px;
            color: #cbd5e1;
        }
        .switch a { color: #22d3ee; font-weight: 700; text-decoration: none; }
        .hint { color: #94a3b8; font-size: 13px; margin-top: 4px; }
        .divider { height: 1px; background: rgba(148,163,184,0.2); margin: 10px 0 6px; }
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #06b6d4;
            cursor: pointer;
        }
        input[name="verification_code"] {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            letter-spacing: 0.5em;
        }
        button:disabled {
            background: #64748b;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>Cr√©er un nouveau compte</h1>
        <p class="subtitle">Rejoignez la plateforme de projets √©tudiants et d√©marrez d√®s maintenant</p>

        {% if request.query_params.get('error') == 'missing_fields' %}
        <div class="error">Merci de remplir tous les champs obligatoires pour l'√©tudiant.</div>
        {% elif request.query_params.get('error') == 'invalid_card' %}
        <div class="error">Format de carte √©tudiant non pris en charge.</div>
        {% elif request.query_params.get('error') == 'duplicate' %}
        <div class="error">Cet email ou nom d'utilisateur est d√©j√† utilis√©. Merci d'en choisir un autre.</div>
        {% elif request.query_params.get('error') == 'accept_rules' %}
        <div class="error">Vous devez accepter les r√®gles pour cr√©er un compte.</div>
        {% elif request.query_params.get('error') == 'invalid_prof_email' %}
        <div class="error">Pour les professeurs, l'email doit contenir "univ" et √™tre une adresse universitaire valide.</div>
        {% elif request.query_params.get('error') == 'missing_verification_code' %}
        <div class="error">Veuillez entrer le code de v√©rification envoy√© √† votre email.</div>
        {% elif request.query_params.get('error') == 'invalid_verification_code' %}
        <div class="error">Code de v√©rification incorrect. Veuillez r√©essayer.</div>
        {% elif request.query_params.get('error') == 'expired_verification_code' %}
        <div class="error">Le code de v√©rification a expir√©. Veuillez demander un nouveau code.</div>
        {% endif %}
        
        <form method="POST" action="/register" enctype="multipart/form-data" id="registerForm">
            <div class="group">
                <label>Pr√©nom</label>
                <input type="text" name="first_name" required>
            </div>
            <div class="group">
                <label>Nom</label>
                <input type="text" name="last_name" required>
            </div>
            <div class="group">
                <label>Nom d'utilisateur</label>
                <input type="text" name="username" required>
            </div>
            <div class="group">
                <label>Email</label>
                <input type="email" name="email" required>
            </div>
            <div class="group">
                <label>Num√©ro de t√©l√©phone</label>
                <input type="tel" name="phone_number">
            </div>
            <div class="group">
                <label>Mot de passe</label>
                <input type="password" name="password" required>
            </div>
            <div class="group">
                <label>Profil</label>
                <select name="role" id="roleSelect" required>
                    <option value="">Choisir un profil</option>
                    <option value="Student">√âtudiant</option>
                    <option value="Professor">Professeur</option>
                </select>
            </div>

            <div class="group">
                <label>Genre</label>
                <select name="gender">
                    <option value="">Choisir</option>
                    <option value="Male">Homme</option>
                    <option value="Female">Femme</option>
                </select>
            </div>
            <div class="group">
                <label>Lieu de naissance</label>
                <select name="birth_place">
                    <option value="">Choisir la ville</option>
                    <option>01 - Adrar</option>
                    <option>02 - Chlef</option>
                    <option>03 - Laghouat</option>
                    <option>04 - Oum El Bouaghi</option>
                    <option>05 - Batna</option>
                    <option>06 - B√©ja√Øa</option>
                    <option>07 - Biskra</option>
                    <option>08 - B√©char</option>
                    <option>09 - Blida</option>
                    <option>10 - Bouira</option>
                    <option>11 - Tamanrasset</option>
                    <option>12 - T√©bessa</option>
                    <option>13 - Tlemcen</option>
                    <option>14 - Tiaret</option>
                    <option>15 - Tizi Ouzou</option>
                    <option>16 - Alger</option>
                    <option>17 - Djelfa</option>
                    <option>18 - Jijel</option>
                    <option>19 - S√©tif</option>
                    <option>20 - Sa√Øda</option>
                    <option>21 - Skikda</option>
                    <option>22 - Sidi Bel Abb√®s</option>
                    <option>23 - Annaba</option>
                    <option>24 - Guelma</option>
                    <option>25 - Constantine</option>
                    <option>26 - M√©d√©a</option>
                    <option>27 - Mostaganem</option>
                    <option>28 - M'Sila</option>
                    <option>29 - Mascara</option>
                    <option>30 - Ouargla</option>
                    <option>31 - Oran</option>
                    <option>32 - El Bayadh</option>
                    <option>33 - Illizi</option>
                    <option>34 - Bordj Bou Arr√©ridj</option>
                    <option>35 - Boumerd√®s</option>
                    <option>36 - El Tarf</option>
                    <option>37 - Tindouf</option>
                    <option>38 - Tissemsilt</option>
                    <option>39 - El Oued</option>
                    <option>40 - Khenchela</option>
                    <option>41 - Souk Ahras</option>
                    <option>42 - Tipaza</option>
                    <option>43 - Mila</option>
                    <option>44 - A√Øn Defla</option>
                    <option>45 - Na√¢ma</option>
                    <option>46 - A√Øn T√©mouchent</option>
                    <option>47 - Gharda√Øa</option>
                    <option>48 - Relizane</option>
                    <option>49 - Timimoun</option>
                    <option>50 - Bordj Badji Mokhtar</option>
                    <option>51 - Ouled Djellal</option>
                    <option>52 - B√©ni Abb√®s</option>
                    <option>53 - In Salah</option>
                    <option>54 - In Guezzam</option>
                    <option>55 - Touggourt</option>
                    <option>56 - Djanet</option>
                    <option>57 - El M'Ghair</option>
                    <option>58 - El Menia</option>
                </select>
            </div>
            <div class="group">
                <label>Sp√©cialit√© / Domaine d'√©tudes</label>
                <select name="specialty" id="specialtySelect" required>
                    <option value="">Choisir une sp√©cialit√©</option>
                    <option>A√©ronautique</option>
                    <option>√âlectronique</option>
                    <option>Structures</option>
                    <option>M√©canique</option>
                    <option>Propulsion</option>
                    <option>Intelligence Artificielle</option>
                    <option>Robotique</option>
                </select>
            </div>
            <div class="group">
                <label>Date de naissance</label>
                <input type="date" name="birth_date">
            </div>

            <div id="studentFields">
                <div class="divider"></div>
                <div class="group">
                    <label>Num√©ro de carte √©tudiant</label>
                    <input type="text" name="student_id_number">
                </div>
            <div class="group">
                <label>Carte √©tudiant (image ou PDF)</label>
                <input type="file" name="student_card" accept="image/*">
                <div class="hint">Formats courants accept√©s (JPG, PNG, PDF).</div>
            </div>
            </div>

            <div id="professorVerification" style="display: none;">
                <div class="divider"></div>
                <div class="group">
                    <label>Code de v√©rification (6 chiffres)</label>
                    <input type="text" name="verification_code" id="verificationCode" maxlength="6" pattern="[0-9]{6}">
                    <div class="hint">Entrez le code de 6 chiffres envoy√© √† votre email universitaire.</div>
                </div>
                <div class="group" id="sendCodeGroup">
                    <button type="button" id="sendCodeBtn" onclick="sendVerificationCode()" style="width: 100%; background: linear-gradient(135deg, #06b6d4, #0891b2);">
                        üìß Envoyer le code de v√©rification
                    </button>
                </div>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button type="button" onclick="showRulesModal()" style="background: #06b6d4; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-right: 10px;">
                    üìú R√®gles d'inscription
                </button>
            </div>

            <div class="group">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="accept_rules" id="acceptRules" required style="margin-left: 0; margin-right: 10px; width: auto;">
                    <span style="color: #e5e7eb;">J'ai lu et j'accepte les r√®gles</span>
                </label>
                <div class="hint">Vous devez accepter les r√®gles pour cr√©er un compte.</div>
            </div>

            <button type="submit" id="submitBtn">Cr√©er le compte</button>
        </form>
        
        <div class="switch">
            Vous avez d√©j√† un compte ? <a href="/">Se connecter</a>
        </div>
    </div>

    <!-- Rules Modal -->
    <div id="rulesModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;">
        <div style="max-width: 800px; margin: 50px auto; background: rgba(17,24,39,0.95); border-radius: 16px; padding: 30px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px;">
                <h2 style="color: #06b6d4; margin: 0; font-size: 24px;">üìú R√®gles d'inscription</h2>
                <button onclick="hideRulesModal()" style="background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 18px;">√ó</button>
            </div>

            <div style="color: #e5e7eb; line-height: 1.6; font-size: 16px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h3 style="color: #22d3ee; margin: 0;">INTERSTELLAR CLUB - Club Universitaire</h3>
                    <p style="color: #94a3b8; margin: 10px 0 0 0;">Cr√©ation d'un nouveau compte</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">1Ô∏è‚É£ Conditions d'acc√®s</h4>
                    <p>La cr√©ation d'un compte est strictement r√©serv√©e aux membres du <strong>Club Interstellaire</strong></p>
                    <p>L'utilisateur doit √™tre :</p>
                    <ul style="margin: 10px 0; padding-left: 30px;">
                        <li>√âtudiant(e) de l'universit√©</li>
                        <li>Enseignant(e) encadrant(e)</li>
                        <li>Ou membre officiellement autoris√© par l'administration du club</li>
                    </ul>
                    <p>Une validation interne du club peut √™tre requise avant l'activation du compte</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">2Ô∏è‚É£ Exactitude des informations</h4>
                    <p>L'utilisateur s'engage √† fournir des informations exactes, compl√®tes et v√©rifiables</p>
                    <p>L'utilisation de fausses informations ou d'identit√©s fictives est interdite</p>
                    <p>Le club se r√©serve le droit de v√©rifier les donn√©es fournies</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">3Ô∏è‚É£ Compte personnel</h4>
                    <p>Chaque membre ne peut cr√©er qu'un seul compte</p>
                    <p>Le partage de compte est strictement interdit</p>
                    <p>L'utilisateur est responsable de toute activit√© effectu√©e via son compte</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">4Ô∏è‚É£ S√©curit√© du compte</h4>
                    <p>L'utilisateur est responsable de la confidentialit√© de son mot de passe</p>
                    <p>Toute tentative d'acc√®s non autoris√© doit √™tre signal√©e imm√©diatement</p>
                    <p>Le club d√©cline toute responsabilit√© en cas de n√©gligence de s√©curit√©</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">5Ô∏è‚É£ Utilisation de la plateforme</h4>
                    <p>La plateforme est destin√©e √† un usage acad√©mique, scientifique et technique</p>
                    <p>Toute utilisation √† des fins commerciales, politiques ou ill√©gales est strictement interdite</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">6Ô∏è‚É£ R√®gles sp√©cifiques au Club Interstellaire</h4>
                    <p>Le respect des valeurs du club est obligatoire :</p>
                    <ul style="margin: 10px 0; padding-left: 30px;">
                        <li>Respect</li>
                        <li>Travail d'√©quipe</li>
                        <li>Responsabilit√©</li>
                        <li>S√©curit√©</li>
                        <li>Innovation technique</li>
                    </ul>
                    <p>L'utilisateur s'engage √† respecter :</p>
                    <ul style="margin: 10px 0; padding-left: 30px;">
                        <li>Le r√®glement interne du club</li>
                        <li>Les d√©cisions du bureau du club</li>
                        <li>Les r√®gles de s√©curit√© pour les projets techniques</li>
                        <li>Les normes de l'universit√©</li>
                    </ul>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">7Ô∏è‚É£ Contenu partag√©</h4>
                    <p>L'utilisateur est enti√®rement responsable du contenu qu'il publie</p>
                    <p>Il est interdit de publier :</p>
                    <ul style="margin: 10px 0; padding-left: 30px;">
                        <li>Contenu offensant ou discriminatoire</li>
                        <li>Contenu dangereux ou non s√©curis√©</li>
                        <li>Contenu violant la propri√©t√© intellectuelle</li>
                    </ul>
                    <p>Les projets techniques (fus√©es, drones, robotique) sont √† but √©ducatif uniquement</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">8Ô∏è‚É£ S√©curit√© & responsabilit√© technique</h4>
                    <p>Toute activit√© technique doit respecter les r√®gles de s√©curit√©</p>
                    <p>Le club et l'universit√© ne sont pas responsables d'un usage incorrect des informations partag√©es</p>
                    <p>Les tests et exp√©rimentations doivent √™tre valid√©s par les responsables du club</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">9Ô∏è‚É£ Confidentialit√© et donn√©es personnelles</h4>
                    <p>Les donn√©es personnelles sont utilis√©es uniquement dans le cadre du club</p>
                    <p>Aucune donn√©e ne sera partag√©e sans autorisation</p>
                    <p>L'utilisateur peut demander la suppression de son compte</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">üöÄ R√®gles sp√©cifiques aux projets spatiaux</h4>
                    <p>Les projets spatiaux (fus√©es, satellites, sondes) sont r√©gis par des r√®gles strictes :</p>
                    <ul style="margin: 10px 0; padding-left: 30px;">
                        <li>Toute construction doit √™tre supervis√©e par un encadrant technique</li>
                        <li>Les tests de lancement n√©cessitent une autorisation pr√©alable</li>
                        <li>Le respect des normes de s√©curit√© a√©rienne est obligatoire</li>
                        <li>Les mat√©riaux utilis√©s doivent √™tre certifi√©s et s√ªrs</li>
                        <li>Documentation compl√®te de chaque √©tape du projet</li>
                    </ul>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">üî¨ R√®gles de s√©curit√© en laboratoire</h4>
                    <p>La s√©curit√© est la priorit√© absolue dans tous les espaces de travail :</p>
                    <ul style="margin: 10px 0; padding-left: 30px;">
                        <li>Port obligatoire des √©quipements de protection individuelle (EPI)</li>
                        <li>Interdiction de travailler seul dans les zones √† risque</li>
                        <li>Signalement imm√©diat de tout incident ou accident</li>
                        <li>Respect des proc√©dures d'urgence et d'√©vacuation</li>
                        <li>Formation obligatoire aux gestes de premiers secours</li>
                        <li>Maintenance r√©guli√®re des √©quipements de laboratoire</li>
                    </ul>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #06b6d4; margin: 20px 0 10px 0;">üìä R√®gles de partage des donn√©es scientifiques</h4>
                    <p>Le partage des donn√©es respecte des principes √©thiques stricts :</p>
                    <ul style="margin: 10px 0; padding-left: 30px;">
                        <li>Les donn√©es exp√©rimentales doivent √™tre exactes et v√©rifi√©es</li>
                        <li>Citation obligatoire des sources et r√©f√©rences</li>
                        <li>Protection des donn√©es sensibles et confidentielles</li>
                        <li>Partage ouvert des r√©sultats positifs comme n√©gatifs</li>
                        <li>Archivage syst√©matique de toutes les donn√©es</li>
                        <li>Respect des droits de propri√©t√© intellectuelle</li>
                    </ul>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #ef4444; margin: 20px 0 10px 0;">üîü Suspension ou suppression du compte</h4>
                    <p>Le club se r√©serve le droit de :</p>
                    <ul style="margin: 10px 0; padding-left: 30px;">
                        <li>Suspendre temporairement le compte</li>
                        <li>Supprimer d√©finitivement le compte</li>
                    </ul>
                    <p>En cas de non-respect des r√®gles, sans pr√©avis</p>
                </div>

                <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button onclick="acceptRules()" style="background: linear-gradient(135deg, #06b6d4, #4f46e5); color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">
                        J'ai lu et j'accepte les r√®gles
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>

        function toggleStudentFields() {
            const roleSelect = document.getElementById('roleSelect');
            const studentFields = document.getElementById('studentFields');
            const professorVerification = document.getElementById('professorVerification');
            const selectedRole = roleSelect.value;
            const isStudent = selectedRole === 'Student';
            const isProfessor = selectedRole === 'Professor';

            if (studentFields) {
                studentFields.style.display = isStudent ? 'block' : 'none';
            }

            if (professorVerification) {
                professorVerification.style.display = isProfessor ? 'block' : 'none';
            }

            if (studentFields) {
                studentFields.querySelectorAll('input, select').forEach(input => {
                if (isStudent) {
                    input.setAttribute('required', 'required');
                } else {
                    input.removeAttribute('required');
                    if (input.type === 'file' || input.type === 'date') {
                        input.value = '';
                    } else {
                        input.value = '';
                    }
                }
            });
            }

            // Handle specialty field requirement
            const specialtySelect = document.getElementById('specialtySelect');
            if (specialtySelect) {
                if (isStudent) {
                    specialtySelect.setAttribute('required', 'required');
                } else {
                    specialtySelect.removeAttribute('required');
                    specialtySelect.value = '';
                }
            }
        }

        function showRulesModal() {
            document.getElementById('rulesModal').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function hideRulesModal() {
            document.getElementById('rulesModal').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        }

        function acceptRules() {
            document.getElementById('acceptRules').checked = true;
            hideRulesModal();
            updateSubmitButton();
        }

        function sendVerificationCode() {
            const emailInput = document.querySelector('input[name="email"]');
            const roleSelect = document.getElementById('roleSelect');
            const sendCodeBtn = document.getElementById('sendCodeBtn');

            if (roleSelect.value !== 'Professor') {
                alert('Cette fonctionnalit√© est r√©serv√©e aux professeurs.');
                return;
            }

            if (!emailInput.value || !emailInput.value.toLowerCase().includes('univ')) {
                alert('Veuillez entrer une adresse email universitaire valide contenant "univ".');
                return;
            }

            // Disable button and show loading
            sendCodeBtn.disabled = true;
            sendCodeBtn.innerHTML = '‚è≥ Envoi en cours...';

            // Send AJAX request to send verification code
            fetch('/send-verification-code', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'email=' + encodeURIComponent(emailInput.value)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Code de v√©rification envoy√© √† votre email universitaire.');
                    document.getElementById('verificationCode').focus();
                    sendCodeBtn.innerHTML = '‚úÖ Code envoy√© - Renvoyer';
                    sendCodeBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                } else {
                    alert('Erreur lors de l\'envoi du code: ' + data.message);
                    sendCodeBtn.innerHTML = 'üìß Envoyer le code de v√©rification';
                }
            })
            .catch(error => {
                alert('Erreur de connexion. Veuillez r√©essayer.');
                sendCodeBtn.innerHTML = 'üìß Envoyer le code de v√©rification';
            })
            .finally(() => {
                sendCodeBtn.disabled = false;
            });
        }

        function updateSubmitButton() {
            const acceptRulesCheckbox = document.getElementById('acceptRules');
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = !acceptRulesCheckbox.checked;
            submitBtn.style.opacity = acceptRulesCheckbox.checked ? '1' : '0.5';
        }

        function validateProfessorEmail() {
            const roleSelect = document.getElementById('roleSelect');
            const emailInput = document.querySelector('input[name="email"]');
            const isProfessor = roleSelect.value === 'Professor';

            if (isProfessor && emailInput.value && !emailInput.value.toLowerCase().includes('univ')) {
                emailInput.setCustomValidity('Pour les professeurs, l\'email doit contenir "univ"');
                emailInput.reportValidity();
                return false;
            } else {
                emailInput.setCustomValidity('');
                return true;
            }
        }

        // Close modal when clicking outside
        document.getElementById('rulesModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideRulesModal();
            }
        });

        // Close modal with ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('rulesModal').style.display === 'block') {
                hideRulesModal();
            }
        });

        // Handle rules acceptance
        const acceptRulesCheckbox = document.getElementById('acceptRules');
        acceptRulesCheckbox.addEventListener('change', updateSubmitButton);
        updateSubmitButton(); // Initialize button state

        // Handle professor email validation
        const roleSelect = document.getElementById('roleSelect');
        const emailInput = document.querySelector('input[name="email"]');

        // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ≠ŸÖŸäŸÑ DOM ŸÇÿ®ŸÑ ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØÿßŸÑÿ©
        document.addEventListener('DOMContentLoaded', function() {
            toggleStudentFields();
        });

        // ÿØŸÖÿ¨ event listeners ŸÑŸÑŸÄ roleSelect ŸÅŸä Ÿàÿßÿ≠ÿØ
        roleSelect.addEventListener('change', function() {
            toggleStudentFields();
            setTimeout(validateProfessorEmail, 100); // Delay to allow role change to process
        });

        emailInput.addEventListener('input', validateProfessorEmail);

        // Form validation before submit
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            if (!acceptRulesCheckbox.checked) {
                e.preventDefault();
                alert('Vous devez accepter les r√®gles pour cr√©er un compte.');
                return false;
            }

            const roleSelect = document.getElementById('roleSelect');
            const verificationCodeInput = document.getElementById('verificationCode');

            if (roleSelect.value === 'Professor') {
                if (!verificationCodeInput.value || verificationCodeInput.value.length !== 6) {
                    e.preventDefault();
                    alert('Veuillez entrer un code de v√©rification valide (6 chiffres).');
                    verificationCodeInput.focus();
                    return false;
                }
            }

            if (!validateProfessorEmail()) {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>